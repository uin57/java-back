<%@page contentType="text/html" pageEncoding="UTF-8"%><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><%@ taglib prefix="sjc" uri="http://www.sjc168.com"%><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript" src="<c:url value='/res/admin/js/audio/audio5.min.js'/>"></script><script type="text/javascript">var audio5js = new Audio5js({	swf_path: '<c:url value="/res/admin/js/audio/audio5js.swf"/>',	ready: function () {		this.load('<c:url value="/res/admin/alarm/system.wav"/>');	}});$(function() {	var options = {		singleSelect:true,		url:'',		columns : [ [ /* {			field : 'id',			title : '序号'		}, */{			field : 'status',			title : '状态',			formatter:function(value,row){		            var txt ="";					if(value == 0){						txt= '未处理';					}else if(value == 1){						txt='拒绝';					}else if(value==2){						txt='完成';					}					return txt;				} 		},{			field : 'userName',			title : '用户名'		},{			field : 'userIdentify',			title : '用户标识',			formatter:function(value,row){					var txt = '';					if(!value || value == 0){						txt= '正常';					}else if(value == 1){						txt= '<span style="color:red;">嫌疑</span>';			        }else if(value == 2){						txt= '<span style="color:green;">VIP</span>';			        }					return txt;							}		},{			field : 'createTime',			title : '申请时间'		},{			field : 'handleTime',			title : '处理时间'		},{			field : 'applyContent',			title : '申请内容'		},{			field : 'receiveCard',			title : '收款银行卡号'		},{			field : 'amount',			title : '余额',			formatter:function(value,row){	            var txt ="";				if(value == null||value==''){					txt= '-';				}else {					txt=value;				}				return txt;			} 		}, {			field : 'operator',			title : '后台操作人员'		}, {			field : 'remark',			title : '备注'		}, {			field : 'other',			title : '操作',			formatter : function(value, row) {				var txt ='';			    if(row.status==0){			    	audio5js.play();			    	var dat = '{id:' + row.id +'}';			    	if (row.applyType == 99) {			    		  txt ='&nbsp;&nbsp;&nbsp;&nbsp;<sjc:auth url="/admin/approval/agree"><a href="#" onClick="agree(\''+row.id+'\')">审核通过</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';					} else {				        txt ='&nbsp;&nbsp;&nbsp;&nbsp;<sjc:auth url="/admin/approval/agree"><a href="#" onClick="showWin(\'#remarkWin\',\'agree\','+ dat +')">审核通过</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';			    	}					txt +='<sjc:auth url="/admin/approval/refuse"><a href="#" onClick="showWin(\'#remarkWin\',\'refuse\','+ dat +')">拒绝</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';			    }else if(row.status==2){			    	var dat = '{id:' + row.id +',remark:\''+(row.remark == null ? '' : row.remark)+'\'}';			    	txt +='&nbsp;&nbsp;&nbsp;&nbsp;<sjc:auth url="/admin/approval/updateRemark"><a href="#" onClick="showWin(\'#remarkWin\',\'updateRemark\','+ dat +')">修改备注</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';			    }else{			    	txt='-';			    }				return txt;			}		}] ],		url : 'list',		queryParams : getQueryParams()	};	createGrid('#grid',options);	createWin("#remarkWin");	$("#search").click(function(){		$("#grid").datagrid("options").queryParams = getQueryParams();		reloadGrid("#grid");	});});function getQueryParams() {	var p={};	$.each($("#form").serializeArray(),function(){          p[this.name]=this.value;      });		return p;}var suspend = false;var timer = setTimer(15000);function refreshTime(t) {	clearInterval(timer);	if (t != -1) {		clearInterval(timer);		timer = setTimer(t);	}}function setTimer(t) {	var timer = setInterval(function() {		if (!suspend) {			$("#search").click();		}	}, t);	return timer;}function agree(id) {	ajaxData('agree?id=' + id, function() {		reloadGrid('#grid');	});}</script></head><body>	<div id="grid"></div>	<div id="tb">		<form id="form" action="list" method="post">		<div>			用户名：<input type="text" size="6" name="userName" />			申请类型：<select name="applyType">					<option value="">不限</option>					<option value="0">修改登录密码</option>					<option value="1">修改安全密码</option>				</select>			申请内容：<input type="text" name="applyContent" />		          申请时间： <td><input type="text" class="easyui-datetimebox beginTime" size="20" name="startTime"/>~<input type="text" class="easyui-datetimebox endTime" size="20" name="endTime"/></td>			状态：<select name="status">				<option value="">不限</option>				<option value="0">未处理</option>				<option value="1">拒绝</option>				<option value="2">完成</option>			</select>			<select onchange="refreshTime(this.value);">          		<option value="-1">暂停</option>          		<option value="15000" selected="selected">15秒</option>                <option value="30000">30秒</option>				<option value="45000">45秒</option>				<option value="60000">60秒</option>	        </select>	                            自动刷新			<a href="#" plain="true" id="search" class="easyui-linkbutton" icon="icon-search">查询</a>		</div>		</form>	</div>	   	<div id="remarkWin">		<form method="post" style="margin: 20px;">			<table class="formtable">			   <input type='hidden' name='id'> 				<tr>					<td class="input-title">备注：</td>					<td><input type="text"  name="remark" /></td>				</tr>							</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#remarkWin');reloadGrid('#grid')})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#remarkWin')">取消</a>			</div>		</form>	</div>		</body></html>