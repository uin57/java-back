<%@page contentType="text/html" pageEncoding="UTF-8"%><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%><%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><%@ taglib prefix="sjc" uri="http://www.sjc168.com"%><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript">$(function() {	createWin("#passWin");	createWin("#safePassWin");	createWin("#statusWin");	createWin("#bankGroupWin");	createWin("#privateRebateWin");	createWin("#dailyRuleWin",{title:'分配契约日薪规则'});	createWin("#dailyRuleWin2",{title:'修改契约日薪规则'});	$("#bankGroupSubmit").click(function(){		$("#bankGruopForm").submit();	});});function addUser(){	addTab('添加总代','<c:url value="/admin/rootUser/add"/>');}function quota(account){	addTab('配额管理','<c:url value="/admin/user/quota?account="/>'+account);}function listDomain(account){	addTab('域名分配','<c:url value="/admin/userDomain/index?account="/>'+account);}function showBank(account){	addTab("银行卡详情",'<c:url value="/admin/bankUser/index?account="/>'+account)}function finds(){	var account = $("#account").val();	var url = '?account='+account;	window.location.href = url;}function modifyUserType(account){	delTip('<c:url value="/admin/user/modify?account="/>'+account,function(rel){		finds();	},"确定将该会员转代理吗?"); }function activeContract(account){	delTip('<c:url value="/admin/contractRule/activeContract?account="/>'+account,function(rel){		finds();	},"确定激活该契约吗?"); }function closeContract(account){	delTip('<c:url value="/admin/contractRule/closeContract?account="/>'+account,function(rel){		finds();	},"确定关闭该契约吗?"); }</script></head><body>	<div class="easyui-panel" fit="true" border="none;">		<div class="search-page">			<div>				会员：<input type="text" size="10" id="account" value="${account }" /> <sjc:auth url="/admin/rootUser/team"><a href="#" plain="true" class="easyui-linkbutton" icon="icon-search" onClick="finds()">查询</a></sjc:auth> 				<sjc:auth url="/admin/rootUser/add"><a href="#" plain="true"					class="easyui-linkbutton" icon="icon-add" onClick="addUser()">添加</a></sjc:auth>					<span style="color:red">${msg}</span>			</div>			<div id="menus">				<a href="?">总代</a>				<c:forEach items="${userTree }" var="a" varStatus="st">			&nbsp;&gt;&gt;&nbsp;<a href="?account=${a}">${a}</a>				</c:forEach>			</div>		</div>		<table class="my-table">			<thead>				<tr>					<th>账户</th>					<th>组别</th>					<th>奖金组</th>					<th>返点</th>					<th>私有返点</th>					<th>余额</th>					<th>团队余额</th>					<th>下线人数</th>					<th>首冲人数</th>					<th>团队人数</th>					<th>卡包</th>					<th>注册时间</th>					<th>登陆时间</th>					<th>登陆冻结</th>					<th>投注冻结</th>					<th>彩中彩冻结</th>					<th>充提冻结</th>					<th>冻结操作员</th>					<th>冻结时间</th>					<th>冻结备注</th>					<th>操作</th>					<th>契约状态</th>				</tr>			</thead>			<tbody>				<c:set var="amount" value="0"/>				<c:set var="teamAmount" value="0"/>				<c:set var="childCount" value="0"/>				<c:set var="teamCount" value="0"/>								<c:forEach items="${list }" var="a">					<tr>						<td><a href="team?account=${a.account}">${a.account}</a></td>						<td><c:choose>								<c:when test="${a.userType==1 }">代理</c:when>								<c:otherwise>会员</c:otherwise>							</c:choose></td>						<td><c:forEach items="${bonusGroup }" var="bg">								<c:if test="${bg.id==a.bonusGroupId }">${bg.title }</c:if>							</c:forEach></td>						<td><fmt:formatNumber value='${a.rebateRatio}' pattern='#.##' />%</td>						<td>							<c:if test="${a.privateRebate > 0 }">							<c:forEach items="${privateRebate }" var="p">								<c:if test="${p.id == a.privateRebate }">${p.name }</c:if>							</c:forEach>							</c:if>						</td>						<td>${a.amount }<c:set var="amount" value="${amount+a.amount }"/></td>						<td>${a.teamAmount }<c:set var="teamAmount" value="${teamAmount+a.teamAmount }"/></td>						<td>${a.childCount }<c:set var="childCount" value="${childCount+a.childCount }"/></td>						<td>${a.firstRechargeCount }<c:set var="firstRechargeCount" value="${a.firstRechargeCount}"/></td>						<td>${a.teamCount }<c:set var="teamCount" value="${teamCount+a.teamCount }"/></td>						<td><c:choose>								<c:when test="${a.account == a.parentAccount }">									<a href="#" onClick="showWin('#bankGroupWin','bankGroup',{account:'${a.account}',bankGroup:'${a.bankGroup }'})">${a.bankGroup == null?'无卡包':a.bankGroup }</a>								</c:when>								<c:otherwise>${a.bankGroup }</c:otherwise>							</c:choose></td>						<td><fmt:formatDate value='${a.regTime}' pattern='yyyy-MM-dd HH:mm:ss' /></td>						<td><fmt:formatDate value='${a.loginTime}' pattern='yyyy-MM-dd HH:mm:ss' /></td>						<td><c:choose>								<c:when test="${a.loginStatus==0 }">									<span style="color: green;">否</span>								</c:when>								<c:otherwise>									<span style="color: red;">是</span>								</c:otherwise>							</c:choose></td>						<td><c:choose>								<c:when test="${a.betStatus==0 }">									<span style="color: green;">否</span>								</c:when>								<c:otherwise>									<span style="color: red;">是</span>								</c:otherwise>							</c:choose></td>						<td><c:choose>								<c:when test="${a.betInStatus==0 }">									<span style="color: green;">否</span>								</c:when>								<c:otherwise>									<span style="color: red;">是</span>								</c:otherwise>							</c:choose></td>						<td><c:choose>								<c:when test="${a.depositStatus==0 }">									<span style="color: green;">否</span>								</c:when>								<c:otherwise>									<span style="color: red;">是</span>								</c:otherwise>							</c:choose></td>						<td>${a.freezeAccount}</td>						<td><fmt:formatDate value='${a.freezeDate}' pattern='yyyy-MM-dd HH:mm:ss' /></td>						<td>${a.freezeRemark }</td>						<td align="left">							<%-- &nbsp;<sjc:auth url="/admin/user/password"><a href="#" onClick="showWin('#passWin','${url}',{status:0,account:'${a.account}',userMark:'${a.userMark==null?'':a.userMark}'})">修改密码</a></sjc:auth>							&nbsp;<sjc:auth url="/admin/user/status"><a href="#" onClick="showWin('#statusWin','${url}',{account:'${a.account}',loginStatus:${a.loginStatus },betStatus:${a.betStatus },betInStatus:${a.betInStatus },depositStatus:${a.depositStatus },statusType:0})">冻结</a></sjc:auth>							&nbsp;<sjc:auth url="/admin/bankUser/index?account="><a href="#" onClick="showBank('${a.account}')">银行卡详情</a></sjc:auth>							<c:if test="${a.userType == 1 }">&nbsp;<sjc:auth url="/admin/user/quota?account="><a href="#" onClick="quota('${a.account}')">配额管理</a></sjc:auth></c:if> --%>							<%--<c:if test="${a.userType == 0 }">&nbsp;<sjc:auth url="/admin/user/modify?account="><a href="#" onClick="modifyUserType('${a.account}')">会员转代理</a></sjc:auth></c:if>--%>							<c:if test="${a.account == a.parentAccount }">&nbsp;<sjc:auth url="/admin/userDomain/index?account="><a href="#" onClick="listDomain('${a.account}')">域名分配</a></sjc:auth></c:if>							<c:if test="${a.contractStatus == 8||a.contractStatus==2 ||a.contractStatus==4 }">&nbsp;<sjc:auth url="/admin/contractRule/activeContract?account="><a href="#" onClick="activeContract('${a.account}')">激活契约</a></sjc:auth></c:if>							<c:if test="${a.contractStatus == 3 }">&nbsp;<sjc:auth url="/admin/contractRule/closeContract?account="><a href="#" onClick="closeContract('${a.account}')">关闭契约</a></sjc:auth></c:if>							&nbsp;<sjc:auth url="/admin/user/privateRebate"><a href="#" onClick="showWin('#privateRebateWin','${url}',{account:'${a.account}',privateRebate:'${a.privateRebate}'})">私返设置</a></sjc:auth>							<c:if test="${a.account == a.parentAccount }">							<c:choose>								<c:when test="${a.dailyRuleId == null }">									&nbsp;<sjc:auth url="/admin/rootUser/updateDailyRule"><a href="#" onClick="showWin('#dailyRuleWin','${url}',{account:'${a.account}'})" title="未分配">契约日薪</a></sjc:auth>								</c:when>								<c:otherwise>									<c:forEach items="${dailyRuleList }" var="dailyRule">										<c:if test="${dailyRule.id == a.dailyRuleId }">											<c:set var="dailyRuleName" value="${dailyRule.name }"></c:set>										</c:if>									</c:forEach>									&nbsp;<sjc:auth url="/admin/rootUser/updateDailyRule"><a href="#" onClick="showWin('#dailyRuleWin2','${url}',{account:'${a.account}',dailyRuleName:'${dailyRuleName }',oldDailyRuleId:'${a.dailyRuleId }'})" title="目前规则：${dailyRuleName }">契约日薪</a></sjc:auth>								</c:otherwise>							</c:choose>							</c:if>						</td>						<td>						   <c:choose>						     <c:when test="${a.contractStatus==8 }">						                   尚未签约						     </c:when>						     <c:when test="${a.contractStatus==0 }">						                   确认契约						     </c:when>						     <c:when test="${a.contractStatus==1 }">						                   已签约						     </c:when>						     <c:when test="${a.contractStatus==2 }">						                   拒绝签约						     </c:when>						     <c:when test="${a.contractStatus==3 }">						                  已激活契约						     </c:when>						     <c:when test="${a.contractStatus==4 }">						                   已关闭契约						     </c:when>						     <c:when test="${a.contractStatus==9 }">						                   已签约（系统）						     </c:when>						   </c:choose>						</td>					</tr>				</c:forEach>					<tr>						<td>合计</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td><span style="color:red;">${amount }</span></td>						<td><span style="color:red;">${teamAmount }</span></td>						<td><span style="color:red;">${childCount }</span></td>						<td><span style="color:red;">${teamCount }</span></td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>						<td>&nbsp;</td>					</tr>			</tbody>		</table>		<%@include file="/WEB-INF/jsp/easyui/page.jsp"%>		<div id="bankGroupWin">			<form method="post" style="margin: 20px;">				<table class="formtable">					<tr>						<td class="input-title">账户</td>						<td><input type="text" readonly name="account" /></td>					</tr>					<tr>						<td class="input-title">卡库</td>						<td><select name="bankGroup">								<c:forEach items="${bankGroup }" var="a">									<option value="${a.title }">${a.title }</option>								</c:forEach>						</select></td>					</tr>				</table>				<div style="text-align: center; padding: 5px;">					<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){location.reload();})">保存</a> <a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#bankGroupWin')">取消</a>				</div>			</form>		</div>		<div id="statusWin">			<form method="post" style="margin: 20px;">				<table class="formtable">					<tr>						<td class="input-title">账户</td>						<td><input type="text" size="5" readonly name="account" /></td>					</tr>					<tr>						<td class="input-title">冻结类型</td>						<td><select name="statusType">								<option value="0">仅自己</option>								<option value="1">仅团队</option>								<option value="2">全部</option>						</select></td>					</tr>					<tr>						<td class="input-title">登陆冻结</td>						<td><select name="loginStatus">								<option value="0">解冻</option>								<option value="1">冻结</option>						</select></td>					</tr>					<tr>						<td class="input-title">投注冻结</td>						<td><select name="betStatus">								<option value="0">解冻</option>								<option value="1">冻结</option>						</select></td>					</tr>					<tr>						<td class="input-title">彩中彩冻结</td>						<td><select name="betInStatus">								<option value="0">解冻</option>								<option value="1">冻结</option>						</select></td>					</tr>					<tr>						<td class="input-title">充提冻结</td>						<td><select name="depositStatus">								<option value="0">解冻</option>								<option value="1">冻结</option>						</select></td>					</tr>					<tr>						<td class="input-title">备注</td>						<td><input type="text" name="remark" /></td>					</tr>				</table>				<div style="text-align: center; padding: 5px;">					<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){location.reload();})">保存</a> 					<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#statusWin')">取消</a>				</div>			</form>		</div>		<div id="passWin">			<form method="post" style="margin: 20px;">				<input type='hidden' name='userMark'/> 				<table class="formtable">					<tr>						<td class="input-title">账户</td>						<td><input type="text" readonly name="account" /></td>					</tr>					<tr>						<td class="input-title">密码类型</td>						<td><select name="status">								<option value="0">登录密码</option>								<option value="1">安全密码</option>						</select></td>					</tr>					<tr>						<td class="input-title">密码</td>						<td><input type="password" name="password" /></td>					</tr>					<tr>						<td class="input-title">确认密码</td>						<td><input type="password" name="password2" /></td>					</tr>				</table>				<div style="text-align: center; padding: 5px;">					<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){$.messager.alert('操作成功', rel.content, 'success');closeWin('#passWin')})">保存</a> <a href="#" class="btn-cancel" icon="icon-cancel"						onClick="closeWin('#passWin')">取消</a>				</div>			</form>		</div>	</div>	<!--私返 -->	<div id="privateRebateWin">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">私返</td>					<td>						<select name="privateRebate">							<option value="0">禁用</option>							<c:forEach items="${privateRebate }" var="a">							<option value="${a.id }">${a.name }</option>							</c:forEach>						</select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this,function(rel){$.messager.alert('操作成功', rel.content, 'success');closeWin('#privateRebateWin')})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#privateRebateWin')">取消</a>			</div>		</form>	</div>	<!-- 契约日薪规则 -->	<div id="dailyRuleWin">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">用户名</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">契约规则</td>					<td>						<select name="dailyRuleId">							<c:forEach items="${dailyRuleList }" var="dailyRule">								<option value="${dailyRule.id }">${dailyRule.name }</option>							</c:forEach>						</select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this,function(rel){location.reload();})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#dailyRuleWin')">取消</a>			</div>		</form>	</div>	<div id="dailyRuleWin2">		<form method="post" style="margin: 20px;">			<input name="oldDailyRuleId" type="hidden" />			<table class="formtable">				<tr>					<td class="input-title">用户名</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">目前规则</td>					<td><input type="text" disabled="disabled" name="dailyRuleName" /></td>				</tr>				<tr>					<td class="input-title">契约规则</td>					<td>						<select name="dailyRuleId">							<c:forEach items="${dailyRuleList }" var="dailyRule">								<option value="${dailyRule.id }">${dailyRule.name }</option>							</c:forEach>						</select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this,function(rel){location.reload();})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#dailyRuleWin2')">取消</a>			</div>		</form>	</div></body></html>