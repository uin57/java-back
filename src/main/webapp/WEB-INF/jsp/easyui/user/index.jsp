<%@page contentType="text/html" pageEncoding="UTF-8"%><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><%@ taglib prefix="sjc" uri="http://www.sjc168.com"%><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript">var bonusGroup=${json};var privateRebates = ${privateRebateJson};var countFields = ['amount','teamAmount','childCount','teamCount'];$(function() {	var options = {		singleSelect:true,		url:'',		columns : [ [ {			field : 'userMark',			title : '用户标识',			formatter:function(value,row){				if(row.account){					var method = "setMark('"+value+"','"+row.account+"');"					var txt = '<a href="#" onclick="'+method+'">';					if(!value || value == 0)						txt+= '正常';					else if(value == 1)						txt+= '<span style="color:red;">嫌疑</span>';					else if(value == 2)						txt+= '<span style="color:green;">VIP</span>';					else if(value == 3)						txt+= '<span style="color:green;">黑名单</span>';					else if(value == 4)						txt+= '<span style="color:green;">招商经理</span>';					else if(value == 5)						txt+= '<span style="color:green;">特权代理</span>';					else if(value == 6)						txt+= '<span style="color:green;">金牌代理</span>';					else if(value == 7)						txt+= '<span style="color:green;">外部主管</span>';					txt+='</a>';					return txt;				} else {					return '';				}			}		},{			field : 'account',			title : '账户',			formatter:function(value,row){				var adminRemark = row.adminRemark;				if (null != adminRemark && adminRemark!='') {					return "<span style='color:#0000ff;' title='" + adminRemark + "'>" + value + "</span>";				} else {					return value;				}			}		},{			field : 'parentAccount',			title : '上级'		},{			field : 'userType',			title : '组别',			formatter:function(value,row){				if(value == 0)					return '会员';				else if(value == 1)					return '代理';			}		}, {			field : 'bonusGroupId',			title : '奖金组',			formatter:function(value,row) {				for(var i=0;i<bonusGroup.length;i++){					var bonus = bonusGroup[i];					if(bonus.id == value){						return bonus.title;					}				}			}		}, {			field : 'rebateRatio',			title : '返点',			formatter:function(value,row){				if(value){					return '<a href="#" onclick="showRebateRatio(\''+ row.account +'\')">'+ value+'%</a>';				} else {					return '';				}			}		}, {			field : 'privateRebate',			title : '私返',			formatter:function(value,row){				for(var v in privateRebates) {					var pr = privateRebates[v];					if(pr.id == value) {						return pr.name;					}				}				return '';			}		}, {			field : 'amount',			title : '余额'		}, {			field : 'teamAmount',			title : '团队余额'		}, {			field : 'childCount',			title : '下线人数'		}, {			field : 'teamCount',			title : '团队人数'		}, {			field : 'test',			title : '测试',			formatter:function(value,row){				if(value==0)					return '否';				else if(value == 1)					return '是';			}		}, {			field : 'bankGroup',			title : '卡包'		}, {			field : 'regTime',			title : '注册时间'		}, {			field : 'loginTime',			title : '登陆时间'		}, {			field : 'loginStatus',			title : '登陆冻结',			formatter : function(value, row) {				if (value==0) {					return '<span style="color:green;">否</span>';				} else if(value == 1) {					return '<span style="color:red;">是</span>';				}			}		}, {			field : 'betStatus',			title : '投注冻结',			formatter : function(value, row) {				if (value==0) {					return '<span style="color:green;">否</span>';				} else if(value == 1) {					return '<span style="color:red;">是</span>';				}			}		}, {			field : 'betInStatus',			title : '彩中彩冻结',			formatter : function(value, row) {				if (value==0) {					return '<span style="color:green;">否</span>';				} else if(value == 1) {					return '<span style="color:red;">是</span>';				}			}		}, {			field : 'depositStatus',			title : '充提冻结',			formatter : function(value, row) {				if (value==0) {					return '<span style="color:green;">否</span>';				} else  if(value == 1){					return '<span style="color:red;">冻结充值</span>';				} else if(value == 2){					return '<span style="color:red;">冻结提现</span>';				} else if (value == 3) {					return '<span style="color:red;">冻结全部</span>';				}			}		}, {			field : 'freezeAccount',			title : '冻结操作员'		}, {			field : 'freezeDate',			title : '冻结时间'		}, {			field : 'freezeRemark',			title : '冻结备注' 		}, {			field : 'dailyWagesStatus',			title : '日工资状态',			formatter : function(value, row) {				if (value==0) {					return '开通';				} else  if(value == 1){					return '关闭';				} else {					return value;				}			}		}, {			field : 'other',			title : '操作',			formatter : function(value, row) {				if(!row['account']) return;				var acc = "{statusType:0,account:'"+row.account+"',loginStatus:"+row.loginStatus+",betStatus:"+row.betStatus+",betInStatus:"+row.betInStatus+",depositStatus:"+row.depositStatus+"}";				var rec = "{account:'"+row.account+"',rechargeLowerTarAmount:"+row.rechargeLowerTarAmount+",accountRecharge:"+row.accountRecharge+"}";				var txt ='&nbsp;&nbsp;&nbsp;&nbsp;<sjc:auth url="/admin/user/rechargeInfo"><a href="#" onClick="showWin(\'#rechargeWin\',\'rechargeInfo\','+rec+')">转账设置</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';					txt +='<sjc:auth url="/admin/user/password"><a href="#" onClick="showWin(\'#passWin\',\'password\',{status:0,account:\''+ row.account +'\',userMark:\''+ (row.userMark==null?'':row.userMark) +'\'})">修改密码</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				txt +='<sjc:auth url="/admin/user/status"><a href="#" onClick="showWin(\'#statusWin\',\'status\','+acc+')" style="color:red;">冻结</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				txt +='<sjc:auth url="/admin/bankUser/index?account="><a href="#" onClick="showBank(\'' + row.account + '\')">银行卡详情</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				txt +='<sjc:auth url="/admin/user/rebateRatio"><a href="#" onClick="setRebateRatio(\'' + row.account + '\',\'' +row.rebateRatio + '\',\'' +row.bonusGroupId + '\',\'' +row.userType + '\')">返点调整</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				txt +='<sjc:auth url="/admin/user/clearSafeAnswer"><a href="#" onClick="setSafeAnswer(\'' + row.account + '\')">重置问答</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				if(row.userType!=0){					txt +='<sjc:auth url="/admin/user/quota?account="><a href="#" onClick="quota(\''+ row.account +'\')">配额管理</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';					txt +='<sjc:auth url="/admin/rootUser/team?account="><a href="#" onClick="team(\''+ row.account +'\')">团队列表</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				}else{					//txt += '<sjc:auth url="/admin/user/modify?account="><a href="#" onClick="modifyUserType(\''+ row.account +'\')">会员转代理</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				}				if(row.bankStatus==1){					txt += '<sjc:auth url="/admin/user/unBank?account="><a href="#" onClick="bankStatus(\''+ row.account +'\')">解锁银行卡</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				}				txt +='<sjc:auth url="/admin/user/updateAremark"><a href="#" onClick="showWin(\'#remark\',\'updateAremark\',{account:\''+ row.account +'\',adminRemark:\''+(row.adminRemark==null?'':row.adminRemark)+'\'})">修改备注</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				if (row.account == row.rootAccount || row.dailyWagesStatus == 0) {					txt +='<sjc:auth url="/admin/user/updateDailyWagesStatus"><a href="#" onClick="showWin(\'#dailyWagesWin\',\'updateDailyWagesStatus\',{account:\''+ row.account +'\',dailyWagesStatus:\''+(row.dailyWagesStatus==null?'':row.dailyWagesStatus)+'\'})">日工资设置</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';				}				return txt;			}		}] ]	};	createGrid('#grid',options);	createWin("#rebateRatioWin");	createWin('#passWin');	createWin("#statusWin");	createWin("#rechargeWin");	createWin("#markWin");	createWin("#remark");	createWin("#dailyWagesWin");		createWin('#rebateDetailsWin',{width:300,height:600,onOpen:function(){			$("#rebateDetailsGrid").datagrid("options").url = 'rebateDetails';			var p = {account:$("#rebateDetailsAccount").text()}			reloadGrid('#rebateDetailsGrid',p);		},onClose:function(){			$('#rebateDetailsGrid').datagrid('loadData', []);		}});		var options2 = {			singleSelect: true,			pagination:false,			url:'',			toolbar:'#detailsTb',			columns : [ [ {				field : 'lotteryName',				title : '彩票'			}, {				field : 'playName',				title : '玩法'			}, {				field : 'rebate',				title : '返点',				formatter:function(value,row){					if(value)						return value+'%';					else						return value;				}			}] ]		};	createGrid('#rebateDetailsGrid',options2);		$("#search").click(function(){		$(grid).datagrid("options")['url'] = 'list';		var p={};		$.each($("#form").serializeArray(),function(){              p[this.name]=this.value;          });		reloadGrid("#grid",p);	});});function showRebateRatio(account){	$("#rebateDetailsAccount").text(account);	showWin('#rebateDetailsWin');}function setMark(mark,account){	showWin('#markWin','setMark',{userMark:mark,account:account});}function setRebateRatio(account,rebateRatio,bonusGroupId,userType){	for(var i in bonusGroup){		var b = bonusGroup[i];		if(b.id == bonusGroupId){			var max = b.rebateRatio;			if(userType == 0){				max = b.playerMaxRatio;			}			var txt = '';			for(var i=max;i>=0;i=i.sub(0.1)){				txt+='<option value="'+i+'">'+ i +'%</option>';			}			$("#rebateRatio").html(txt);		}	}	showWin('#rebateRatioWin','rebateRatio',{account:account,rebateRatio:rebateRatio});}function setSafeAnswer(account){	delTip('<c:url value="/admin/user/clearSafeAnswer?account="/>'+account,function(rel){		$.messager.alert('提示', '操作成功', 'info');	},"确认重置用户安全问答?");}function quota(account){	addTab('配额管理','<c:url value="/admin/user/quota?account="/>'+account);}function team(account){	addTab("团队列表",'<c:url value="/admin/rootUser/team?account="/>'+account)}function showBank(account){	addTab("银行卡详情",'<c:url value="/admin/bankUser/index?account="/>'+account)}function bankStatus(account){	delTip('<c:url value="/admin/user/unBank?account="/>'+account,function(rel){		reloadGrid("#grid");	},"确定要解锁吗?"); }function modifyUserType(account){	delTip('<c:url value="/admin/user/modify?account="/>'+account,function(rel){		reloadGrid("#grid");	},"确定将该会员转代理吗?"); }</script></head><body>	<div id="grid"></div>	<div id="tb">		<form id="form" action="list" method="post">		<div>			会员：<input type="text" size="6" name="account" />			奖金组：<select name="bonusGroup">				<option value="">不限</option>				<c:forEach items="${bonusGroup }" var="a">				<option value="${a.id }">${a.title }</option>				</c:forEach></select>			返点：<input type="text" size="3" name="beginRebateRatio"/>~<input type="text" size="3" name="endRebateRatio"/>			余额：<input type="text" size="3" name="beginAmount" />~<input type="text" size="3" name="endAmount" />			注册时间：<select name="regTime">					<option value="">不限</option>					<option value="3">3天内</option>					<option value="7">7天内</option>					<option value="30">30天内</option>					<option value="60">60天内</option>				</select>			组别：<select name="userType">				<option value="">不限</option>				<option value="0">会员</option>				<option value="1">代理</option>			</select>			测试：<select name="test">				<option value="">不限</option>				<option value="0">否</option>				<option value="1">是</option>			</select>			冻结：<select name="status">				<option value="">不限</option>				<option value="0">否</option>				<option value="1">是</option>			</select>			排序：<select name="order">				<option value="0">注册时间</option>				<option value="1">余额</option>				<option value="2">返点</option>			</select>			用户标识：<select name="userMark">			    <option value="">不限</option>				<option value="0">正常</option>				<option value="1">嫌疑用户</option>				<option value="2">VIP</option>				<option value="3">黑名单</option>				<option value="4">招商经理</option>				<option value="5">特权代理</option>				<option value="6">金牌代理</option>				<option value="7">外部主管</option>			</select>			<a href="#" plain="true" id="search" class="easyui-linkbutton" icon="icon-search">查询</a>		</div>		</form>	</div>		<div id="rebateRatioWin">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">返点</td>					<td><select name="rebateRatio" id="rebateRatio"></select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#rebateRatioWin','#grid')})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#rebateRatioWin')">取消</a>			</div>		</form>	</div>		<div id="statusWin">		<form method="post" style="margin: 20px;" id="statusForm" action="status">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" size="5" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">冻结类型</td>					<td><select name="statusType">						<option value="0">仅自己</option>						<option value="1">仅团队</option>						<option value="2">全部</option>					</select></td>				</tr>				<tr>					<td class="input-title">登陆冻结</td>					<td><select name="loginStatus">						<option value="0">解冻</option>						<option value="1">冻结</option>					</select></td>				</tr>				<tr>					<td class="input-title">投注冻结</td>					<td><select name="betStatus">						<option value="0">解冻</option>						<option value="1">冻结</option>					</select></td>				</tr>				<tr>					<td class="input-title">彩中彩冻结</td>					<td><select name="betInStatus">						<option value="0">解冻</option>						<option value="1">冻结</option>					</select></td>				</tr>				<tr>					<td class="input-title">充提冻结</td>					<td><select name="depositStatus">						<option value="0">解冻</option>						<option value="1">冻结充值</option>						<option value="2">冻结提现</option>						<option value="3">冻结全部</option>					</select></td>				</tr>				<tr>					<td class="input-title">备注</td>					<td><input type="text" name="remark" /></td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#statusWin','#grid');})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#statusWin')">取消</a>			</div>		</form>	</div>	<div id="passWin">		<form method="post" style="margin: 20px;">			<table class="formtable">			<input type='hidden' name='userMark'> 				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">密码类型</td>					<td><select name="status">						<option value="0">登录密码</option>						<option value="1">安全密码</option>					</select></td>				</tr>				<tr>					<td class="input-title">密码</td>					<td><input type="password" name="password" /></td>				</tr>				<tr>					<td class="input-title">确认密码</td>					<td><input type="password" name="password2" /></td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ $.messager.alert('操作成功', rel.content, 'success');closeWin('#passWin')})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#passWin')">取消</a>			</div>		</form>	</div>	<div id="rechargeWin">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">今日已累计收款</td>					<td><input type="text" name="rechargeLowerTarAmount" /></td>				</tr>				<tr>					<td class="input-title">会员转账</td>					<td><select name="accountRecharge">						<option value="0">禁用</option>						<option value="1">启用</option>					</select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#rechargeWin','#grid');})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#rechargeWin')">取消</a>			</div>		</form>	</div>		<div id="markWin">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">用户标识</td>					<td><select name="userMark">						<option value="0">正常</option>						<option value="1">嫌疑</option>						<option value="2">VIP</option>						<option value="3">黑名单</option>						<option value="4">招商经理</option>						<option value="5">特权代理</option>						<option value="6">金牌代理</option>						<option value="7">外部主管</option>					</select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#markWin','#grid');})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#markWin')">取消</a>			</div>		</form>	</div>	<!-- 返点详情 -->	<div id="rebateDetailsWin">		<div id="rebateDetailsGrid"></div>		<div id="detailsTb">			<div>会员：<span id="rebateDetailsAccount"></span></div>		</div>	</div>	<div id="remark">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">后台用户备注</td>					<td><input type="text" name="adminRemark" /></td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#remark','#grid');})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#remark')">取消</a>			</div>		</form>	</div>	<div id="dailyWagesWin">		<form method="post" style="margin: 20px;">			<table class="formtable">				<tr>					<td class="input-title">账户</td>					<td><input type="text" readonly name="account" /></td>				</tr>				<tr>					<td class="input-title">设置</td>					<td>						<select name="dailyWagesStatus">							<option value="0">开通工资</option>							<option value="1">关闭工资</option>						</select>					</td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#dailyWagesWin','#grid');})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#dailyWagesWin')">取消</a>			</div>		</form>	</div></body></html>