<%@page contentType="text/html" pageEncoding="UTF-8"%><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%><%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><%@ taglib prefix="sjc" uri="http://www.sjc168.com"%><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript">var countFields = ['win', 'amount'];//var seasonRules = ${json};	$(function() {/* 		$(".beginTime").datebox("setValue",new Date().addHour(-4,'yyyy-MM-dd 04:00:00'));   	   	$(".endTime").datebox("setValue",new Date().addDay(1).addHour(-4,'yyyy-MM-dd 04:00:00')); */     	setWebDefaultTime();   	   	if('${begin}') {   			$('.beginTime').datebox("setValue", '${begin}');   			$('#statuss').combobox('setValues',[1,2]);   	   	}   	   	if('${end}') {			$('.endTime').datebox("setValue", '${end}');   	   	}		var options = {			url:'listForBet',				//singleSelect:true,			queryParams : getQueryParams(),			columns : [ [ {				field : 'id',				title : '序号',				formatter : function(value, row) {					var	txt ="";					if(value!=null){						txt= "<a href='javascript:;' class='fontColorRed' onClick =\"showBetDetail('"+value+"','"+row.account+"')\">"+value+"</a>";					}else{					}					return txt;				}			}, {				field : 'createTime',				title : '投注时间',			}, {				field : 'userMark',				title : '用户标识',				formatter:function(value,row){					if(row.account){						if(!value || value == 0)							return '正常';						else if(value == 1)							return '<span style="color:red;">嫌疑</span>';						else if(value == 2)							return '<span style="color:green;">VIP</span>';						else if(value == 3)							return '<span style="color:green;">黑名单</span>';						else if(value == 4)							return '<span style="color:green;">招商经理</span>';						else if(value == 5)							return '<span style="color:green;">特权代理</span>';						else if(value == 6)							return '<span style="color:green;">金牌代理</span>';						else if(value == 7)							return '<span style="color:green;">外部主管</span>';						else							return value;					} else {						return '';					}				}			}, {				field : 'account',				title : '用户'			}, {				field : 'lotteryName',				title : '彩种'			}, {				field : 'seasonId',				title : '期号'			}, {				field : 'playName',				title : '玩法'			},{				field : 'theoreticalBonus',				title : '理论奖金',							},{				field : 'amount',				title : '投注金额'			},{				field : 'win',				title : '奖金',				formatter : function(value, row){					if(value>0){						return '<span style="color:red;">'+value+'</span>';					}else if(value==0){						return '<span style="color:red;">'+'0'+'</span>';					}else{						return '<span >'+' '+'</span>';					}				}			}, {				field : 'winRate',				title : '中投比',				formatter : function(value, row){					if(row.win>0){						return '<span style="color:red;">'+(row.win/row.amount).toFixed(4);+'</span>';					}else if(row.win==0){						return '<span style="color:red;">'+'0'+'</span>';					}				}			},{				field : 'content',				title : '投注内容',				formatter:function(value,row){					if(!value){						return " ";					}					if( value.length > 24 ){//超过24个字节则显示详情						var n = 0;						if(value.indexOf(".")>0) n = 1;						newstr=value.substring(0,24)+"...";						detailBtn = "<a href='javascript:;' class='fontColorRed' onClick =\"showContentDetail('"+row.id+"','"+value+"',"+n+")\">详情</a>";						return '<span>'+newstr+detailBtn+'</span>';					}else{						return '<span>'+value+'</span>';					}				}			}, {				field : 'openNum',				title : '开奖号码'			},{				field : 'price',				title : '倍数'			},{				field : 'unit',				title : '模式',				formatter : function(value, row){					if(value==2){						return '<span >元</span>';					}else if(value==0.2){						return '<span >角</span>';					}else if(value==0.02){						return '<span >分</span>';					}else if(value==0.002){						return '<span >厘</span>';					}else{						return " ";					}				}			}, {				field : 'bonusType',				title : '返奖类型',				formatter : function(value, row) {					if(value==0){						return '<span >高奖</span>';					}else if(value==1){						return '<span style="color:red;">高返</span>';					}else{						return ' ';					}				}			},{				field : 'status',				title : '状态',				 formatter : function(value, row) {					 switch(value){					 case 0: return '<span >等待开奖</span>';					 case 1:return '<span >已中奖</span>';					 case 2:return '<span >未中奖</span>';					 case 3: return '<span >未开始</span>';					 case 4:return '<span >个人撤单</span>';					 case 5:return '<span >系统撤单</span>';					 case 6:return '<span >未开奖</span>';					 case 7:return '<span >恶意注单</span>';					 case 8:return '<span >暂停</span>';					 case 9:return '<span >追中撤单</span>';					 }				} 			},{				field : 'isTrace',				title : '追号',				formatter : function(value, row) {				  if(row.account!=null){					  if(value==0){							return '<span >否</span>';						}else {							return '<span>是</span>';						} 				  }else{					  return '<span> </span>';				  }									}			}, {                field : 'userAgent',                title : '投注终端'            },{				field : 'other',				title : '操作',				formatter : function(value, row) {					var txt =" ";					if(row.status==0){						txt = "<sjc:auth url="/admin/report/canCleOrder"><a href='javascript:;' class='fontColorRed' onClick =\"Confirm('是否删除该记录？','"+ row.id+ "','"+ row.account+ "')\">撤单</a></sjc:auth>";					}					return txt;				}			}] ],			onLoadSuccess : function (pageData) {				doCountField(grid);				$("#pageDataSum").text(pageData.obj.amount);				$("#pageDataWin").text(pageData.obj.win);			}		};		createGrid('#grid',options);		createWin("#contentWin",{width:450,height:350});		createWin("#detailWin",{width:800,height:350,title:'详情'});		$("#search").click(function(){			/* var p={};			$.each($("#form").serializeArray(),function(){  	            p[this.name]=this.value;  	        });			reloadGrid("#grid",p); */						$("#grid").datagrid("options").queryParams = getQueryParams();			reloadGrid("#grid");		});				$("#contentWin,#delContentPlan").scroll(function(){			var plan = $(this);			var div = plan.find("div:first");			var mainHeight = plan.height();			var scroTop = plan.scrollTop();			var height = div.height();						if (mainHeight + scroTop ==height)     //当文档的高度小于或者等于总的高度的时候，开始动态加载数据			{				var n =  parseInt( div.attr("data-n") );				if(isNaN(n) || n<1){					//不需要加载数据					return;				}				var id = div.attr("data-id");				var args = {id:id,n:n};				var url = '<c:url value="/admin/report/contentDetails"/>?id='+id+"&n="+n;				ajaxData(url,function(rel){					var content = rel.content;					//TODO					if(content.indexOf(".")>0){						content = content.replace(/\./g,"");						n++;					} else {						n=0;					}					div.attr("data-n",n);					var old = div.text();																				old = old.replace(/\./g,"")+content;					if(n>0){						old+="...";					}					div.text(old);				});			} 		});	});    	function getQueryParams() {		var p={};		p['statuss'] = $('#statuss').combobox('getValues').join(",");		$.each($("#form").serializeArray(),function(){              p[this.name]=this.value;          });				return p;	}	function opens(a,title){		addTab(title+' - '+$(a).text(),$(a).attr("data-href"));	}		function showContentDetail(id,content,n){		/* var textArea = "<textarea rows='5' style='width: 100%;resize: none;overflow-x:hidden;border:1px solid' disabled>"+content+"</textarea>";		$("#contentDetails").html(textArea);		$.dialog("#contentDetailsArea"); */		$("#winC").html(content);		$("#winC").attr("data-id",id);		$("#winC").attr("data-n",n);		showWin("#contentWin");	}    	function canCleOrder(id,account){   		var url ='<c:url value="/admin/report/canCleOrder?id="/>'+id+"&account="+account;   		ajaxData(url,function(rel){reloadGrid("#grid");});   	}   	   	function showBetDetail(id,account){   		$.getJSON("<c:url value='/admin/report/showBetDetail'/>","id="+id+"&account="+account,function(data){   			$("#delContent").text(data.content);   			if(data.content.indexOf(".")>0){   				$("#delContent").attr("data-id",data.id);   				$("#delContent").attr("data-n",1);   			}   			$("#delLotteryName").text(data.lotteryName);   			$("#delSeasonId").text(data.seasonId);   			$("#delCreateTime").text(data.createTime);   			$("#delAmounts").text("￥"+data.amount);   			$("#delRebateRatio").text(data.rebateRatio);   			$("#number").text(data.id);   			$("#delPlayName").text(data.playName);   			$("#delBetCount").text(data.betCount);   			$("#delPrice").text(data.price);   			$("#delAmount").text("￥"+data.amount);   			var unitName;   			if(data.unit==2){   				unitName="元";   			}else if(data.unit==0.2){   				unitName="角";   			}else if(data.unit==0.02){   				unitName="分";   			}else{   				unitName="厘";   			}   			$("#delUnit").text(unitName);   			if(data.openNum!=null){   				$("#delOpenNum").text(data.openNum);   			}else{   				$("#delOpenNum").text("");   			}   			var bonusType;   			if(data.bonusType==0){   				bonusType ="高奖";   			}else{   				bonusType="高返";   			}   			$("#delBonusType").text(bonusType);   			$("#delBonusType").text(bonusType);   			var delWinName;   			if(data.status==0||data.status==3||data.status==6){   				delWinName="等待开奖";   			}else if(data.status==4||data.status==5||data.status==9){   				delWinName="已撤单";   			}else if(data.status==1||data.status==2){   				delWinName="￥"+data.win;   			}else if(data.status==8){   				delWinName="暂停";   			}else if(data.status==7){   				delWinName="恶意注单";   			}   			$("#delWin").text(delWinName);   			showWin("#detailWin");   		});   		   	}   	   	$(document).ready(function(){   		//通过彩种初始化获取玩法和期号   		$('#lotteryId').change(function(){    			var p=$(this).children('option:selected').val();//这就是selected的值    			$("option").remove(".playerOptions");   			$.getJSON("<c:url value='/admin/report/ajaxAdminSelect'/>","lotteryId="+p,function(data){   					var d= " ";   					for (var key in data) {    			              var p="<option class=\"playerOptions\" value="+key+">"+data[key]+"</option>";   							d+=p;   			          }    				   					$('#playerOption').after(d);   			})   			     			});   		   	});   	function Confirm(msg,id,account) {		$.messager.confirm("确认", msg, function(r) {			if (r) {				canCleOrder(id,account);				return true;			}		});		return false;	}</script></head><body>	<div id="grid"></div>	<div id="tb">		<div>			<form id="form" action="listForBet" method="post">				   <table>		       <tr>		          <td>用户名：</td>		          <td> <input type="text" size="10" name="account" value="${account }" /></td>		          <td><input name="include" type="checkbox" value="1"/>包含下级</td>		     				  <td>用户类型：</td>				  <td><select name="test" style="width: 130px;">						<option value="2">不限</option>						<option value="0" selected="selected">非测试</option>						<option value="1">测试</option>					 </select>			      </td>			     			      <td>投注时间：</td>			      <td><input type="text" class="easyui-datetimebox beginTime" size="16" name="startTime" />~<input type="text" class="easyui-datetimebox endTime" size="16" name="endTime" /></td>			       <td>彩种组：</td>		          <td><select style="width: 100px;" id="groupName" name="groupName">		                 <option value="">不限</option>						<c:forEach items="${groups }" var="g">							<option value="${g }">${g }</option>						</c:forEach>				      </select>				  </td>			      <td>中奖金额：</td>				  <td><input type="text" size="9.5" name="lowerAmount" />~<input type="text" size="9.5" name="highAmount" /></td>			           <td>方案编号：</td>		          <td> <input type="text"  name="id" style="width: 198px;"/></td>		       </tr>		       <tr>	          		          <td>彩种：</td>		          <td colspan="2" ><select id="lotteryId" style="width: 100px;" name="lotteryId" >				        <option value="">不限</option>						<c:forEach items="${lotteryList}" var="item">						<option value="${item.id}">${item.title}</option>						</c:forEach>				       </select>		          </td>				   <td>游戏玩法:</td>                   <td>                                          <select style="width: 130px;" name="playerId" class="labelCond playerId" id="betPlayerId">                                    <option id ="playerOption" value=" ">所有玩法</option>                                </select>		           </td>				  <td>起始期数：</td>			      <td><input type="text" style="width: 140px;" name="startSeasonId" />~<input type="text" style="width: 140px;" name="endSeasonId" /></td>			       <td>订单状态：</td>		          <td ><select id="statuss" name="status" style="width: 100px;" class="easyui-combobox" multiple="multiple">		                <!-- <option value=" ">不限</option> -->						<option value="0">等待开奖（封盘前）</option>						<option value="6">未开奖（封盘后）</option>						<option value="1">已中奖</option>						<option value="2">未中奖</option>						<!-- <option value="3">未开始</option> -->						<option value="8">暂停</option>						<option value="4">个人撤单</option>						<option value="5">系统撤单</option>						<option value="9">追中撤单</option>						<option value="7">恶意注单</option>			          </select>		          </td>		          <td>投注金额：</td>				  <td><input type="text" size="9.5" name="betLowerAmount" />~<input type="text" size="9.5" name="betHighAmount" /></td>				      <td> <a href="#" plain="true" id="search" class="easyui-linkbutton" icon="icon-search">查询</a></td>		       </tr>		       <tr>			       	<td colspan="2">投注金额总计：<span id="pageDataSum">0</span></td>			       	<td colspan="2">中奖金额总计：<span id="pageDataWin">0</span></td>			   </tr>		   </table>		  				</form>	</div>			</div>	<div id="contentWin">		<div id="winC"></div>	</div>	<div id="detailWin">		<div class="detailHeaderBox">                <h3  id="delLotteryName"></h3>                <div>                    <table style="display: inline-block ">                        <tr>                            <th><span>期号：</span></th>                           <td><span id="delSeasonId"></span></td>                        </tr>                        <tr>                           <th><span>投注时间：</span></th>                           <td><span id="delCreateTime"></span></td>                        </tr>                        <tr>                           <th><span>返点：</span></th>                           <td><span id="delRebateRatio"></span></td>                        </tr>                        <tr>                           <th><span>投注总金额：</span></th>                           <td><span id="delAmounts"></span></td>                        </tr>                        <tr>                           <th><span>方案编号：</span></th>                           <td> <span id="number"></span></td>                        </tr>                    </table>                       <div class="detailNumBox" style="display: inline-block;margin-left: 50px;">		                	<span style="font-weight: bold">投注内容：</span>							<div id="delContentPlan"								style="border: 1px solid #ccc; width: 300px; height: 100px; OVERFLOW: auto;">								<div id="delContent" ></div>							</div>			            </div>                </div>                         <div >                <table border="0" >                    <tr >                        <th width="120">玩法</th>                        <th width="50">注数</th>                        <th width="50">倍数</th>                         <th width="100">投注金额</th>                        <th width="50">模式</th>                        <th width="180">开奖号码</th>                        <th width="50">备注</th>                        <th width="120">状态</th>                    </tr>                    <tr>                        <td><span id="delPlayName"></span></td>                        <td><span id="delBetCount"></span></td>                        <td><span id="delPrice"></span></td>                        <td><span class="fontColorTheme" id="delAmount"></span></td>                        <td><span id="delUnit"></span></td>                        <td><span  id="delOpenNum"></span></td>                        <td><span id="delBonusType"></span></td>                        <td><span class="fontColorTheme" id="delWin"></span></td>                    </tr>                                  </table>            </div>          	</div>	</div></body></html>