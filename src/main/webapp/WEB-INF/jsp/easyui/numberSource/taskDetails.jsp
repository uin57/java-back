<%@page contentType="text/html" pageEncoding="UTF-8"%><%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><%@ taglib prefix="sjc" uri="http://www.sjc168.com"%><html xmlns="http://www.w3.org/1999/xhtml"><head><script type="text/javascript">	$(function() {		var options = {			singleSelect:true,			columns : [ [ {				field : 'job_GROUP',				title : '任务组'			}, {				field : 'job_NAME',				title : '任务名称'			}, {				field : 'trigger_GROUP',				title : '触发器组',							}, {				field : 'trigger_NAME',				title : '触发器名称',			}, {				field : 'next_FIRE_TIME',				title : '下次执行时间',				formatter:function(value,row){					if (value>1000)					return new Date(value).format("yyyy-MM-dd hh:mm:ss");				}			}, {				field : 'prev_FIRE_TIME',				title : '上次执行时间',				formatter:function(value,row){					if (value>1000)					return new Date(value).format("yyyy-MM-dd hh:mm:ss");				}			}, {				field : 'priority',				title : '优先级',			}, {				field : 'trigger_STATE',				title : '状态',			}, {				field : 'start_TIME',				title : '开始时间',				formatter:function(value,row){					if (value>1000)					return new Date(value).format("yyyy-MM-dd hh:mm:ss");				}			}, {				field : 'end_TIME',				title : '结束时间',				formatter:function(value,row){					if (value>1000)						return new Date(value).format("yyyy-MM-dd hh:mm:ss");				}			}, {				field : 'cron_EXPRESSION',				title : '表达式', 			}, {				field : 'job_CLASS_NAME',				title : '类名称', 			},{				field : 'other',				title :'操作',				formatter : function(value, row) {					var txt = '&nbsp;&nbsp;&nbsp;&nbsp;<sjc:auth url="/admin/taskDetails/start"><a onClick="opens(this)" href="#" data-href="<c:url value="/admin/taskDetails/start?jobgroup="/>'+ escape(encodeURIComponent(row.job_GROUP)) +'&jobname='+ escape(encodeURIComponent(row.job_NAME)) +'&triggergroup='+ escape(encodeURIComponent(row.trigger_GROUP)) +'&triggername='+ escape(encodeURIComponent(row.trigger_NAME)) +'">启动</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';					txt+='<sjc:auth url="/admin/taskDetails/stop"><a onClick="opens(this)"  href="#" data-href="<c:url value="/admin/taskDetails/stop?jobgroup="/>'+ escape(encodeURIComponent(row.job_GROUP)) +'&jobname='+ escape(encodeURIComponent(row.job_NAME)) +'&triggergroup='+ escape(encodeURIComponent(row.trigger_GROUP)) +'&triggername='+ escape(encodeURIComponent(row.trigger_NAME)) +'">停止</a></sjc:auth>&nbsp;&nbsp;&nbsp;&nbsp;';					return txt;				}			}			] ]		};		createGrid('#grid',options);		createWin("#win");		createWin("#helpwin");		$("#tb a").linkbutton();		$("#search").click(function(){			var p={};			$.each($("#form").serializeArray(),function(){  	            p[this.name]=this.value;  	        });			$("#grid").datagrid("options").queryParams = p;			reloadGrid("#grid");		});			});	//--------------	function opens(a){		//window.location.href =$(a).attr("data-href");		ajaxData($(a).attr("data-href"),function(rel){			reloadGrid("#grid");		});	}	function editns() {		var rows = $("#grid").datagrid('getSelected');		var num = rows.length;		if (num <= 0) {			$.messager.alert('提示', '请选择一条记录进行操作!', 'info');		}		else{			showWin("#win","edit",rows);		}	}	function delns() {		var rows = $("#grid").datagrid('getSelected');		var num = rows.length;		if (num <= 0) {			$.messager.alert('提示', '请选择一条记录进行操作!', 'info');		}		else{			var url ='<c:url value="/admin/taskDetails/delete?jobgroup="/>'+ escape(encodeURIComponent(rows.job_GROUP)) 			 +"&jobname="+ escape(encodeURIComponent(rows.job_NAME))			 +"&triggergroup="+ escape(encodeURIComponent(rows.trigger_GROUP))			 +"&triggername="+ escape(encodeURIComponent(rows.trigger_NAME));			ajaxData(url,function(rel){				reloadGrid("#grid");			});		}	}	$(document).ready(function(){		$('#grid').datagrid('hideColumn','trigger_GROUP');		$('#grid').datagrid('hideColumn','trigger_NAME');	});	var suspend = false;	var timer = setTimer(15000);		function refreshTime(t) {		clearInterval(timer);		if (t != -1) {			clearInterval(timer);			timer = setTimer(t);		}	}		function setTimer(t) {		var timer = setInterval(function() {			if (!suspend) {				$("#search").click();			}		}, t);		return timer;	}		function getInfos(url){		ajaxData(url,function(rel){			$.messager.alert('信息', rel.content, 'info');		});	}</script></head><body>	<div id="grid"></div>	<div id="tb" style="padding: 5px; height: auto">		<div>			<sjc:auth url="/admin/taskDetails/add"><a href="#" plain="true" icon="icon-add" class="easyui-linkbutton" onClick="showWin('#win','add')">添加</a></sjc:auth>			<sjc:auth url="/admin/taskDetails/edit"><a href="#" plain="true" icon="icon-edit" class="easyui-linkbutton" onClick="editns()">修改</a></sjc:auth>			<sjc:auth url="/admin/taskDetails/delete"><a href="#" plain="true" icon="icon-edit"  class="easyui-linkbutton" onClick="delns()">删除</a></sjc:auth>		</div>		<div>			<form id="form" action="list" method="post">				<table>			       <tr>			       	  <td>任务组：</td>			          <td><input type="text" size="20" name="group" /></td>				      <td>名称：</td>				      <td><input type="text" size="20" name="groupName" /></td>			          <td>			          	<select onchange="refreshTime(this.value);">			          		<option value="-1">暂停</option>			          		<option value="15000" selected="selected">15秒</option>			                <option value="30000">30秒</option>							<option value="45000">45秒</option>							<option value="60000">60秒</option>				        </select>				                            自动刷新			          </td>			          <td> <a href="#" plain="true" id="search" class="easyui-linkbutton" icon="icon-search">查询</a></td>			       </tr>			   </table>			</form>		</div>		<div>			<sjc:auth url="/admin/taskDetails/startAll"><a href="#" plain="true" icon="icon-save"  class="easyui-linkbutton" onClick="getInfos('${url}')">启动调度</a></sjc:auth>			<sjc:auth url="/admin/taskDetails/stopAll"><a href="#" plain="true" icon="icon-save"  class="easyui-linkbutton" onClick="getInfos('${url}')">停止调度</a></sjc:auth>			<sjc:auth url="/admin/taskDetails/getInfo"><a href="#" plain="true" icon="icon-save"  class="easyui-linkbutton" onClick="getInfos('${url}')">调度信息</a></sjc:auth>		</div>	</div>	<div id="win">		<form method="post" style="margin: 20px;">			<table class="formtable" data-options="onClickRow:getSelected">				<tr>					<td class="input-title">任务组</td>					<td><input type="text" id="job_GROUP" name="job_GROUP"/></td>				</tr>				<tr>					<td class="input-title">任务名称</td>					<td><input type="text" id="job_NAME"  name="job_NAME"/></td>					<td><input  type="hidden" id="trigger_GROUP" name="trigger_GROUP" /></td>					<td><input type="hidden" id="trigger_NAME" name="trigger_NAME" /></td>				</tr>				<tr>					<td class="input-title">类名称</td><!-- 					<td><input type="text" id="job_CLASS_NAME" name="job_CLASS_NAME"/></td> -->						<td>							<select id="job_CLASS_NAME" name="job_CLASS_NAME" style="width:152px">								<option value="com.hs3.tasks.lotts.CreateSeasonJob">奖期自动生成任务</option>								<option value="com.hs3.tasks.lotts.LotteryManagerJob">彩票管理任务</option>								<option value="com.hs3.tasks.report.CreateReportJob">盈亏报表统计任务</option>								<option value="com.hs3.tasks.user.ClearUserDepositJob">清除用户提现次数任务</option>								<option value="com.hs3.tasks.report.CreateInReportJob">彩中彩盈亏报表</option>								<option value="com.hs3.tasks.lotts.Canada3_5Job">加拿大3.5奖期自动修改</option><!-- 								<option value="com.hs3.tasks.report.PrivateRebateJob">投注私返派发</option> -->								<option value="com.hs3.tasks.sys.SysMailtaskJob">自动发送邮件</option>								<option value="com.hs3.tasks.finance.DepositDoingAutoJob">自动处理提款申请</option>								<option value="com.hs3.tasks.finance.RechargeReportJob">充值统计</option>								<option value="com.hs3.tasks.report.CreateNewReportJob">综合报表统计任务</option>								<option value="com.hs3.tasks.finance.RechargeCheckAndClearJob">充值记录检查清除任务</option>								<option value="com.hs3.tasks.report.CreateNonIntegratedReportJob">代理报表统计任务</option>								<option value="com.hs3.tasks.report.CreateUserAgentsJob">日工资、周期分红统计任务</option>							</select>						</td>				</tr>				<tr>					<td class="input-title">表达式</td>					<td><input type="text" id="cron_EXPRESSION" name="cron_EXPRESSION"/></td>				</tr>			</table>			<div style="text-align: center; padding: 5px;">				<a href="#" class="btn-save" icon="icon-save" onClick="saveData(this, function(rel){ closeWin('#win','#grid')})">保存</a>				<a href="#" class="btn-cancel" icon="icon-cancel" onClick="closeWin('#win')">取消</a>			</div>		</form>	</div></body></html>>>>>>>> 2bf7edf632a63dbced302115c9e1740afe67f695