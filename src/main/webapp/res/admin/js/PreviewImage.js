(function ($) {    // use $("div").PreviewImage({width:100,height:100});    $.fn.PreviewImage = function (options) {        var defaults = {            width: 100,            height: 60        };        var opts = $.extend(defaults, options);        return this.each(function () {            var _this = $(this);            var input = _this.find("input");            var img = _this.find("img");            img.css({'width': opts.width + 'px', 'height': opts.height + 'px'});            input.hide();            input.change(function () {                if (this.value) {                    //img.attr('src', this.files[0].getAsDataURL());                    try {                        img.attr('src', getObjectURL(this.files[0]));                    } catch (e) {                        this.select();                        //var src = document.selection.createRange().text;                        //图片异常的捕捉，防止用户修改后缀来伪造图片                        try {                            _this.css({                                'filter': 'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)',                                'width': opts.width + 'px',                                'height': opts.height + 'px'                            });                            _this.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = document.selection.createRange().text;                        } catch (e) {                            alert("您上传的图片格式不正确，请重新选择!");                            return false;                        }                        img.hide();                        document.selection.empty();                    }                    //opts.callback();                }            });            img.click(function () {                input.click();            });        });    };    function getObjectURL(file) {        var url = null;        if (window.createObjectURL != undefined) {            url = window.createObjectURL(file);        } else if (window.URL != undefined) {            url = window.URL.createObjectURL(file);        } else if (window.webkitURL != undefined) {            url = window.webkitURL.createObjectURL(file);        }        return url;    };})(jQuery);